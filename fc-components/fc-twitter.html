<link rel="import" href="../dev/polymer/polymer.html">
<link rel="import" href="../dev/paper-button/paper-button.html">
<link rel="import" href="../dev/paper-input/paper-input.html">

<dom-module id="fc-twitter">

	<template>
		<h3>Twitter Feed</h3>
		<paper-input id="fcTrack" label="Twitter Search Term" on-keydown="_checkChange"></paper-input>
		<paper-button on-tap="_changeTerm">Shout!</paper-button>
	</template>



</dom-module>

<script>
	//
	// twitter.get('favorites/list', function(error, tweets, response) {
	// 	if (error) throw error;
	// 	console.log(tweets);
	// });

	Polymer({
		is: 'fc-twitter',
		properties: {
			twitterStream: Object,
			twitter: Object,
			searchTerm: String
		},
		_checkChange: function(e) {
			console.log("Key hit");
			if (e.keyCode == 13) {
				this._change();
			}
		},
		created: function() {
			var remote = require('remote');
			this.twitter = remote.require('twitter');

		},
		_openTwitterStream: function() {
			var ref = this;
			var tttt = this.searchTerm;
			this.twitterStream = new this.twitter({
				consumer_key: 'jMfUHwaQXJlEUO9yr5iL2ULpL',
				consumer_secret: 'k0mb3pNQhv1EF1abVrELlEknO1mkveKMkbhTVQi49PeeYxZ1zm',
				access_token_key: '16248228-lX75POEti2UBms5ULjlJHIlE67CAio58bts4THxdd',
				access_token_secret: '2QEWSyLzHQlE4WwdqR3pTMqergViJVJYKTAzDAB4k3fF2'
			});

			ref.twitterStream.stream('statuses/filter', {
				track: ref.searchTerm
			}, function(stream) {
				stream.on('data', function(tweet) {
					console.log(tweet.text);
				});
			});

		},
		_changeTerm: function() {
			console.log("Changing term");
			this.searchTerm = this.$.fcTrack.value;
			this.twitterStream = null;
			this._openTwitterStream();
		},
		_add: function() {
			var ref = this;
			if (ref.$.fcShout.value && ref.$.fcUser.value) {
				var shoutdata = {
					user: ref.$.fcUser.value,
					body: ref.$.fcShout.value,
					source: 'Local User'

				}
				console.debug("Shoutdata input", shoutdata);
				ref.fire('add-shout', {
					//value: this.$.fcInput.value
					value: shoutdata
				});
				ref.$.fcShout.value = null;
			}
		}
	});
</script>
